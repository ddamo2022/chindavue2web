(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/goods"],{"006a":function(t,e,n){"use strict";n.r(e);var o=n("b472"),r=n.n(o);for(var i in o)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(i);e["default"]=r.a},"1e5a":function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return r})),n.d(e,"a",(function(){}));var o=function(){var t=this,e=t.$createElement,n=(t._self._c,t.rollOrder&&t.rollOrder.length);t._isMounted||(t.e0=function(e){t.wcshow=!1}),t.$mp.data=Object.assign({},{$root:{g0:n}})},r=[]},"2d70":function(t,e,n){},b472:function(t,e,n){"use strict";(function(t){var o=n("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=o(n("7eb4")),i=o(n("3b2d")),s=o(n("ee10")),a=o(n("7ca3")),c=n("8f59"),u=n("cc12"),d=o(n("77a5")),l=n("d468");function p(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function g(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?p(Object(n),!0).forEach((function(e){(0,a.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var f={components:{uniNavBar:function(){n.e("components/third/uni-nav-bar").then(function(){return resolve(n("c474"))}.bind(null,n)).catch(n.oe)},BarLeft:function(){n.e("pages/index/goods/gtop/bar-left").then(function(){return resolve(n("a9c0"))}.bind(null,n)).catch(n.oe)},ChangeShop:function(){n.e("pages/index/goods/gtop/change-shop").then(function(){return resolve(n("dd16"))}.bind(null,n)).catch(n.oe)},ShopNotice:function(){n.e("components/goods/shop-notice").then(function(){return resolve(n("7b39"))}.bind(null,n)).catch(n.oe)},Actions:function(){n.e("components/goods/actions/actions").then(function(){return resolve(n("b7fd"))}.bind(null,n)).catch(n.oe)},ProductModal:function(){Promise.all([n.e("common/vendor"),n.e("components/goods/product-modal/product-modal")]).then(function(){return resolve(n("30ec"))}.bind(null,n)).catch(n.oe)},CartBar:function(){n.e("components/goods/cartbar/cartbar").then(function(){return resolve(n("6f15"))}.bind(null,n)).catch(n.oe)},cartPopup:function(){n.e("components/goods/cart-popup/cart-popup").then(function(){return resolve(n("6785"))}.bind(null,n)).catch(n.oe)},businessStatus:function(){n.e("pages/index/goods/business").then(function(){return resolve(n("cb3a"))}.bind(null,n)).catch(n.oe)},load:function(){n.e("components/common/load").then(function(){return resolve(n("1332"))}.bind(null,n)).catch(n.oe)},sqBtn:function(){Promise.all([n.e("common/vendor"),n.e("components/common/sq-btn")]).then(function(){return resolve(n("c52b"))}.bind(null,n)).catch(n.oe)},iDefault:function(){n.e("components/common/default").then(function(){return resolve(n("1c4b"))}.bind(null,n)).catch(n.oe)},gAd:function(){Promise.all([n.e("common/vendor"),n.e("components/drag/ad")]).then(function(){return resolve(n("a7cc"))}.bind(null,n)).catch(n.oe)},picLunboBy:function(){n.e("components/drag/picLunbo").then(function(){return resolve(n("7630"))}.bind(null,n)).catch(n.oe)},tcyhq:function(){Promise.all([n.e("common/vendor"),n.e("components/template/tcyhq")]).then(function(){return resolve(n("783a"))}.bind(null,n)).catch(n.oe)},classTs1:function(){n.e("components/goods/template/class-ts1").then(function(){return resolve(n("c963"))}.bind(null,n)).catch(n.oe)},classTs2:function(){n.e("components/goods/template/class-ts2").then(function(){return resolve(n("0b0b"))}.bind(null,n)).catch(n.oe)},classTs3:function(){n.e("components/goods/template/class-ts3").then(function(){return resolve(n("be8f"))}.bind(null,n)).catch(n.oe)},classTs4:function(){n.e("components/goods/template/class-ts4").then(function(){return resolve(n("ba30"))}.bind(null,n)).catch(n.oe)},rollBag:function(){n.e("pages/index/goods/rollBag/rollBag").then(function(){return resolve(n("c952"))}.bind(null,n)).catch(n.oe)},rollPopup:function(){n.e("pages/index/goods/rollBag/rollPopup").then(function(){return resolve(n("660d"))}.bind(null,n)).catch(n.oe)}},data:function(){return{loading:!0,mainRef:null,categories:[],cart:[],sIndex:0,rectInfoList:[],tempCurrent:0,scrollTop:0,product:{},ccId:0,notices:[],productModalVisible:!1,cartPopupShow:!1,pstop:0,showSearch:!1,showShopInfo:!1,diningType:"",xdtype:"",goodsAd:[],swiper:{imgUrl:[],height:"260",circle:"30"},wcshow:!1,wcInfo:"",rollOrder:[],categoryGoods:[]}},onShow:function(){t.getStorageSync("xdtype")&&(this.xdtype=t.getStorageSync("xdtype"),this.diningType=1==this.xdtype?0:1),this.isload&&this.refresh(),t.getStorageSync("hGoodsId")&&this.storeId&&this.handdl({id:t.getStorageSync("hGoodsId")})},computed:g(g(g({},(0,c.mapState)(["sjxx","sjgood"])),(0,c.mapState)("dndc",["latLng"])),(0,c.mapState)({storeBasicSetting:function(t){return t.config.storeBasicSetting},orderSetting:function(t){return t.config.orderSetting},scarList:function(t){return t.scarList.out||[]},gs:function(t){return t.layout.goodStyle||{}}})),mixins:[l.utilMixins],onLoad:function(e){var n=this;return(0,s.default)(r.default.mark((function o(){var i;return r.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return console.log("options",e),i=d.default.getOptions(e,{key:"storeId",q1:e.storeId}),n.loading=!0,n.storeId=i||t.getStorageSync("storeId"),console.log("storeId",n.storeId),o.next=7,n.load(n.storeId);case 7:e&&e.goodId&&n.handdl({id:e.goodId});case 8:case"end":return o.stop()}}),o)})))()},methods:g(g(g({},(0,c.mapActions)(["getSjxx","getConfig","getGoods","supdCar","getMycar"])),(0,c.mapMutations)(["setScarList","setGoods"])),{},{load:function(e){var n=this;return(0,s.default)(r.default.mark((function o(){return r.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.next=2,n.getLoginInfo();case 2:return n.storeId=e,o.next=5,n.getDw();case 5:n.getLayout(),n.getConfig({ident:["storeBasicSetting","orderSetting"]}),t.removeStorageSync("storeId");case 8:case"end":return o.stop()}}),o)})))()},getDw:function(){var t=this;return(0,s.default)(r.default.mark((function e(){var n,o;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,u.getDw)({t:0});case 2:if(n=e.sent,t.lc=n,t.storeId){e.next=11;break}return e.next=7,t.util.request({url:t.api.mrmd,data:{lat:n.latitude||"",lng:n.longitude||""}});case 7:o=e.sent,o&&o.data?(t.storeId=o.data,t.init()):t.go({t:2,url:"/pages/shop/select/index?page=goods'"}),e.next=12;break;case 11:t.init();case 12:case"end":return e.stop()}}),e)})))()},init:function(){var e=this;return(0,s.default)(r.default.mark((function n(){return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e.loading=!0,n.next=3,e.getSjxx({storeId:e.storeId,lat:e.lc.latitude||"",lng:e.lc.longitude||""});case 3:if(e.cDiningType(),!e.gs||2!=e.gs.goodsStyle){n.next=9;break}return n.next=7,e.getCategory();case 7:n.next=10;break;case 9:e.getGoods({storeId:e.storeId,diningType:e.diningType}).then((function(){e.categories=d.default.deepCopy(e.sjgood),e.ccId=e.categories.length&&e.categories[0].id,e.havebxp=e.sjgood.findIndex((function(t){return 1==t.isMust}))>-1,e.$nextTick((function(){return e.$refs["classTs"].calcSize()})),e.loading=!1})).catch((function(){e.loading=!1}));case 10:e.getMycar({storeId:e.storeId,diningType:e.diningType,lat:e.lc.latitude||"",lng:e.lc.longitude||""}),e.gAd(),e.getWc(),e.gRollOrder(),e.storeId=e.sjxx.id,t.getStorageSync("hGoodsId")&&e.storeId&&e.handdl({id:t.getStorageSync("hGoodsId")}),e.isload=!0;case 17:case"end":return n.stop()}}),n)})))()},getCategory:function(){var t=this;return(0,s.default)(r.default.mark((function e(){var n,o;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.util.request({url:t.api.gCategory,data:{storeId:t.storeId,diningType:t.diningType}});case 2:if(n=e.sent,o=n.data,!o||!o.length){e.next=13;break}return t.categories=o,t.havebxp=t.categories.findIndex((function(t){return 1==t.isMust}))>-1,t.ccId=o[0].id,t.setGoods({params:{storeId:t.storeId,dType:"out"},data:o}),e.next=11,t.getCategoryGoods();case 11:e.next=14;break;case 13:t.loading=!1;case 14:case"end":return e.stop()}}),e)})))()},getCategoryGoods:function(){var t=this;return(0,s.default)(r.default.mark((function e(){var n,o;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.util.request({url:t.api.goods,data:{storeId:t.storeId,diningType:t.diningType,categoryId:t.ccId}});case 2:n=e.sent,o=n.data,t.categoryGoods=o||[],t.loading=!1;case 6:case"end":return e.stop()}}),e)})))()},refresh:function(){var t=this;return(0,s.default)(r.default.mark((function e(){return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.cDiningType(),e.next=3,t.getMycar({storeId:t.storeId,diningType:t.diningType,lat:t.latLng.lat?t.latLng.lat:"",lng:t.latLng.lng?t.latLng.lng:""});case 3:case"end":return e.stop()}}),e)})))()},gAd:function(){var t=this;return(0,s.default)(r.default.mark((function e(){var n,o,i;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.util.request({url:t.api.gglb,data:{location:2,storeId:t.storeId}});case 2:if(n=e.sent,o=n.data,t.goodsAd=o?o.window:[],o.banner&&o.banner.length>0){for(i in o.banner)o.banner[i].url=o.banner[i].link;t.swiper={imgUrl:o.banner,height:"260",circle:"30"}}else t.swiper={imgUrl:[],height:"260",circle:"30"};case 6:case"end":return e.stop()}}),e)})))()},getWc:function(){var t=this;return(0,s.default)(r.default.mark((function e(){var n,o;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.util.request({url:t.api.wc,data:{pos:2,storeId:t.storeId}});case 2:n=e.sent,o=n.data,o&&(t.wcInfo=o,setTimeout((function(){t.wcshow=!0}),400));case 5:case"end":return e.stop()}}),e)})))()},gRollOrder:function(){var t=this;return(0,s.default)(r.default.mark((function e(){var n,o;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.util.request({url:t.api.couponPack,data:{storeId:t.storeId}});case 2:n=e.sent,o=n.data,t.rollOrder=o?o.list:[];case 5:case"end":return e.stop()}}),e)})))()},cDiningType:function(){var e=this.sjxx&&this.sjxx.storeSetting;return this.sjxx&&e&&1==e.pickupSwitch&&1==e.takeoutSwitch?(this.buyType=2,2==this.orderSetting.orderPriority&&(this.buyType=1),this.xdtype&&(this.buyType=this.xdtype,setTimeout((function(){t.removeStorageSync("xdtype")}),2e3)),this.diningType=2==this.buyType?this.sjxx.storeSetting.defaultType:0):this.sjxx&&e&&0==e.pickupSwitch&&1==e.takeoutSwitch?(this.buyType=1,this.diningType=2==this.buyType?this.sjxx.storeSetting.defaultType:0):this.sjxx&&e&&1==e.pickupSwitch&&0==e.takeoutSwitch?(this.buyType=2,this.diningType=2==this.buyType?this.sjxx.storeSetting.defaultType:0):void 0},switchOrderType:function(t){var e=this;return(0,s.default)(r.default.mark((function n(){return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e.diningType=t,e.getGoods({storeId:e.storeId,diningType:e.diningType}).then((function(){e.categories=d.default.deepCopy(e.sjgood),e.ccId=e.categories.length&&e.categories[0].id,e.havebxp=e.sjgood.findIndex((function(t){return 1==t.isMust}))>-1,e.$nextTick((function(){return e.$refs["classTs"].calcSize()}))})),n.next=4,e.getMycar({storeId:e.storeId,diningType:e.diningType,lat:e.lc.latitude||"",lng:e.lc.longitude||"",isChange:1});case 4:case"end":return n.stop()}}),n)})))()},handcar:function(t){var e=this;return(0,s.default)(r.default.mark((function n(){return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(console.log("p",t),e.isLogin||e.noLogin){n.next=4;break}return e.$refs["sqBtn"].open(),n.abrupt("return");case 4:return n.prev=4,n.next=7,e.supdCar({storeId:e.storeId,spuId:t.g.id,specMd5:t.g.specSwitch?t.g.specInfo&&t.g.specInfo.specMd5:t.g.specMd5||t.g.singleSpec.specMd5,attrData:t.g.specMd5?t.g.attrData||{}:t.g.specSwitch||t.g.attrSwitch||t.g.materialSwitch?{spec:t.g.specSwitch&&t.g.ggdata?t.g.ggdata:"",attr:t.g.attribute,matal:t.g.jldata,material:t.g.material}:{},num:t.addwz,lat:e.lc.latitude||"",lng:e.lc.longitude||"",diningType:e.diningType});case 7:n.sent,n.next=13;break;case 10:n.prev=10,n.t0=n["catch"](4),console.log(n.t0);case 13:case"end":return n.stop()}}),n,null,[[4,10]])})))()},handdl:function(e){var n=this;return(0,s.default)(r.default.mark((function o(){var i;return r.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(t.removeStorageSync("hGoodsId"),!(e&&2==e.type||n.gs&&3==n.gs.goodsDetail)){o.next=5;break}n.go({t:1,url:"/pages/shop/good-dl?goodId=".concat(e.id,"&storeId=").concat(n.storeId,"&diningType=").concat(n.diningType,"&dType=out")}),o.next=11;break;case 5:return o.next=7,n.util.request({url:"".concat(n.api.goods,"/").concat(e.id),data:{storeId:n.storeId,diningType:n.diningType}});case 7:i=o.sent,n.product=i.data,n.productModalVisible=!0,n.$refs["productModal"].open(e,n.storeId,n.diningType);case 11:case"end":return o.stop()}}),o)})))()},handleAddToCartInModal:function(t){this.handcar(t),this.closeProductDetailModal()},closeProductDetailModal:function(){var t=this;this.productModalVisible=!1,this.$refs["productModal"].close(),setTimeout((function(){t.product={}}),100)},openCartDetailsPopup:function(){this.$refs["cartPopup"].open()},clearCart:function(){this.cart=[]},handMenu:function(t,e){var n=this;if(this.gs&&2==this.gs.goodsStyle){if(this.ccId==t)return;this.ccId=t,this.getCategoryGoods()}else this.sIndex=e,this.pstop=this.categories.find((function(e){return e.id==t})).top,this.$nextTick((function(){return n.ccId=t}))},psroll:function(e){var n=this,o=e.detail,r=o.scrollTop,i=r+140,s=this.categories.filter((function(t){return t.top<=i})).reverse();s.length>0&&(this.ccId=s[0].id),this.rectInfoList.forEach((function(e,o){r>=e.top&&r<=e.bottom&&(n.scrollTop=o*t.upx2px(100),n.sIndex=o)}))},rfcalc:function(t,e){this.rectInfoList=t,this.categories=e},calcSize:function(){var e=this,n=0,o=t.createSelectorQuery().select("#ads");o.fields({size:!0},(function(t){n+=Math.floor(t&&t.height)})).exec(),this.categories.forEach((function(o,r){var i=t.createSelectorQuery().select("#g-".concat(o.id));i.fields({size:!0,rect:!0},(function(t){o.top=n,n+=Math.floor(t.height),o.bottom=n,e.rectInfoList[r]={top:o.top,bottom:o.bottom}})).exec()}))},pay:function(){var e=this;return(0,s.default)(r.default.mark((function n(){var o,s;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.isLogin||e.noLogin){n.next=3;break}return e.$refs["sqBtn"].open(),n.abrupt("return");case 3:if(o=e.sjxx.storeSetting,o&&(1==o.pickupSwitch||1==o.takeoutSwitch)){n.next=7;break}return e.util.message(e.$t("goods.store_no_order_channel"),3,2e3),n.abrupt("return");case 7:if(!e.havebxp){n.next=11;break}if(s=function(){var t=e.sjgood.filter((function(t){return 1==t.isMust})),n=0,o=e.scarList.goodsList.map((function(t){return t.spuId}));if(e.gs&&2==e.gs.goodsStyle)for(var r=0;r<t.length;r++)e.scarList.categoryIds&&e.scarList.categoryIds.includes(t[r].id)&&(n+=1);else for(var i=0;i<t.length;i++)t[i].goodsList.find((function(t){return o.includes(t.id)}))&&(n+=1);if(n<t.length)return{v:e.util.message(e.$t("goods.add_required_items"),3,1500)}}(),"object"!==(0,i.default)(s)){n.next=11;break}return n.abrupt("return",s.v);case 11:if(e.jjmbxx){n.next=21;break}return n.prev=12,n.next=15,e.requestSM(["integralChange","balanceChange","vipChange"]);case 15:n.next=21;break;case 17:return n.prev=17,n.t0=n["catch"](12),e.jjmbxx=!0,n.abrupt("return");case 21:t.navigateTo({url:"/pages/shop/out/pay-order?diningType=".concat(1==e.diningType?e.sjxx&&e.sjxx.storeSetting.defaultType:e.diningType)});case 22:case"end":return n.stop()}}),n,null,[[12,17]])})))()},serach:function(){this.go({t:1,url:"/pages/shop/search/out?page=shopGoods"})},rollOpen:function(){this.$refs["rollPopup"].open()}}),onShareAppMessage:function(){var t="pages/index/goods?storeId=".concat(this.storeId);return this.product&&this.product.id&&(t="pages/index/goods?storeId=".concat(this.storeId,"&goodId=").concat(this.product.id)),this.util.mpShare({t:this.product&&this.product.name||this.sjxx.name,i:this.getImgS(this.product&&this.product.logo),p:t})}};e.default=f}).call(this,n("df3c")["default"])},d596:function(t,e,n){"use strict";(function(t,e){var o=n("47a9");n("b483");o(n("3240"));var r=o(n("e026"));t.__webpack_require_UNI_MP_PLUGIN__=n,e(r.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},e026:function(t,e,n){"use strict";n.r(e);var o=n("1e5a"),r=n("006a");for(var i in r)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return r[t]}))}(i);n("f8cd");var s=n("828b"),a=Object(s["a"])(r["default"],o["b"],o["c"],!1,null,"b92c5d22",null,!1,o["a"],void 0);e["default"]=a.exports},f8cd:function(t,e,n){"use strict";var o=n("2d70"),r=n.n(o);r.a}},[["d596","common/runtime","common/vendor"]]]);