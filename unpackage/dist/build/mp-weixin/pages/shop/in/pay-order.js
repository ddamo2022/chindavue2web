(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/shop/in/pay-order"],{"31bf":function(e,n,t){"use strict";t.r(n);var r=t("d313"),o=t.n(r);for(var a in r)["default"].indexOf(a)<0&&function(e){t.d(n,e,(function(){return r[e]}))}(a);n["default"]=o.a},"38cd":function(e,n,t){"use strict";var r=t("a168"),o=t.n(r);o.a},"402b":function(e,n,t){"use strict";t.r(n);var r=t("fe84"),o=t("31bf");for(var a in o)["default"].indexOf(a)<0&&function(e){t.d(n,e,(function(){return o[e]}))}(a);t("38cd");var c=t("828b"),u=Object(c["a"])(o["default"],r["b"],r["c"],!1,null,"1b690086",null,!1,r["a"],void 0);n["default"]=u.exports},"46b2":function(e,n,t){"use strict";(function(e,n){var r=t("47a9");t("b483");r(t("3240"));var o=r(t("402b"));e.__webpack_require_UNI_MP_PLUGIN__=t,n(o.default)}).call(this,t("3223")["default"],t("df3c")["createPage"])},a168:function(e,n,t){},d313:function(e,n,t){"use strict";(function(e){var r=t("47a9");Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o=r(t("7eb4")),a=r(t("7ca3")),c=r(t("ee10")),u=t("8f59"),i=r(t("77a5"));function d(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?d(Object(t),!0).forEach((function(n){(0,a.default)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):d(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}getApp().globalData;var l={components:{SelfFetch:function(){Promise.all([t.e("common/vendor"),t.e("pages/shop/in/components/self-fetch")]).then(function(){return resolve(t("1657"))}.bind(null,t)).catch(t.oe)},Pay:function(){Promise.all([t.e("common/vendor"),t.e("components/pay/pay")]).then(function(){return resolve(t("1e12"))}.bind(null,t)).catch(t.oe)},CheckGoods:function(){t.e("components/pay-order/check-goods").then(function(){return resolve(t("375e"))}.bind(null,t)).catch(t.oe)},Discounts:function(){t.e("components/pay-order/discounts").then(function(){return resolve(t("a113"))}.bind(null,t)).catch(t.oe)},CheckNotes:function(){t.e("components/pay-order/check-notes").then(function(){return resolve(t("1cc6"))}.bind(null,t)).catch(t.oe)},ConsumptionGift:function(){t.e("components/goods/consumption-gift").then(function(){return resolve(t("2ccd"))}.bind(null,t)).catch(t.oe)},CheckSave:function(){t.e("pages/shop/in/components/check-save").then(function(){return resolve(t("4b59"))}.bind(null,t)).catch(t.oe)},Tcyhq:function(){Promise.all([t.e("common/vendor"),t.e("components/template/tcyhq")]).then(function(){return resolve(t("783a"))}.bind(null,t)).catch(t.oe)},CheckPoint:function(){t.e("components/pay-order/check-point").then(function(){return resolve(t("ef72"))}.bind(null,t)).catch(t.oe)},Waiter:function(){t.e("components/pay-order/waiter").then(function(){return resolve(t("c3a5"))}.bind(null,t)).catch(t.oe)}},data:function(){return{showLoading:!1,orderInfo:{},deliveryMode:2,params:{remarks:"",mobile:"",couponId:0},loading:!1,yjrV:{},radioType:1,current:"",wcshow:!1,wcInfo:"",query:{},sn:""}},onLoad:function(n){var t=this;return(0,c.default)(o.default.mark((function r(){var a;return o.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:t.util.setNT(t.$t("pay_order.submit_order")),t.params.storeId=t.sjxx.id,t.params.mobile=t.user.mobile||"",n&&n.tableId&&(a=n.tableId,n.diningType,t.query=n,t.getCheckOut(a)),e.$on("payorder",(function(e){e.hasOwnProperty("hbInfo")&&1==e.type&&(t.params.couponId=e.hbInfo?e.hbInfo.id:0,t.getCheckOut(1==t.deliveryMode?0:t.radioType)),console.log("payorderEl",e)}));case 5:case"end":return r.stop()}}),r)})))()},computed:s(s(s({},(0,u.mapState)(["sjxx"])),(0,u.mapState)({orderSetting:function(e){return e.config.orderSetting},copywriting:function(e){return e.layout.copywriting},style:function(e){return e.layout.style||{}}})),{},{totaltax:function(){return Number(this.orderInfo.taxIncluded)+Number(this.orderInfo.vatMoney)}}),onUnload:function(){e.$off("payorder")},methods:s(s({},(0,u.mapActions)(["getInCar"])),{},{getCheckOut:function(){var e=this;return(0,c.default)(o.default.mark((function n(){var t,r;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.util.request({url:e.api.incheck,method:"POST",data:{tableId:e.query.tableId,diningType:e.query.diningType,storeId:e.sjxx.id,notes:e.params.remarks,mobile:e.params.mobile,couponId:e.params.couponId}});case 2:t=n.sent,r=t.data,e.orderInfo=i.default.deepCopy(r);case 5:case"end":return n.stop()}}),n)})))()},setNote:function(e){this.params.remarks=e,this.getCheckOut()},radioChange:function(e){var n=this;return(0,c.default)(o.default.mark((function t(){var r;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,n.util.request({url:n.api.goodsPackAll,method:"POST",data:{type:0==e?"back":"",tableId:n.query.tableId,storeId:n.sjxx.id,diningType:n.query.diningType}});case 2:r=t.sent,r.data,n.getCheckOut();case 5:case"end":return t.stop()}}),t)})))()},savePay:function(){var e=this;return(0,c.default)(o.default.mark((function n(){return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.jjmbxx){n.next=10;break}return n.prev=1,n.next=4,e.requestSM(["pay","receive","".concat(1==e.deliveryMode?"delivery":"takeMeal")]);case 4:n.next=10;break;case 6:return n.prev=6,n.t0=n["catch"](1),e.jjmbxx=!0,n.abrupt("return");case 10:e.pay();case 11:case"end":return n.stop()}}),n,null,[[1,6]])})))()},pay:function(){var n=this;return(0,c.default)(o.default.mark((function t(){var r,a,c,u;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n.loading=!0,t.next=3,n.util.request({url:n.api.inOrder,method:"POST",ct:1,mask:n.$t("pay_order.placing_order"),data:{tableId:n.query.tableId,diningType:n.query.diningType}});case 3:r=t.sent,a=r.data,c=r.msg,a?(u=a.prentOrderSn||a.orderSn,u&&e.setStorageSync("nologin_orderid",u),1==a.payType?n.payOpen(a.orderSn,a.prentOrderSn):2==a.payType&&(n.util.message(c,3),n.go({t:2,url:"/pages/order/detail?id=".concat(a.prentOrderSn||a.orderSn)}))):(n.util.message(c,3),n.loading=!1);case 7:case"end":return t.stop()}}),t)})))()},payOpen:function(e,n){this.sn=n,this.$refs["Pay"].open(JSON.stringify({orderSn:e,orderType:4,go:{t:3,url:"/pages/order/detail?id=".concat(n||e)}}))},cPay:function(){this.getInCar({storeId:this.sjxx.id,tableId:this.query.tableId,diningType:this.query.diningType})},getWc:function(){var e=this;return(0,c.default)(o.default.mark((function n(){var t,r;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.util.request({url:e.api.wc,data:{pos:4,storeId:e.sjxx.id}});case 2:t=n.sent,r=t.data,r&&(e.wcInfo=r,setTimeout((function(){e.wcshow=!0}),400)),console.log("wc",r);case 6:case"end":return n.stop()}}),n)})))()},callWaiter:function(){var e=this;return(0,c.default)(o.default.mark((function n(){var t,r;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.util.modal(e.$t("pay_order.are_you_sure_you_want_to_call_the_waiter"));case 2:return n.next=4,e.util.request({url:"".concat(e.api.call,"/").concat(e.query.tableId)});case 4:t=n.sent,r=t.data,e.util.message(r,3,2e3);case 7:case"end":return n.stop()}}),n)})))()}})};n.default=l}).call(this,t("df3c")["default"])},fe84:function(e,n,t){"use strict";t.d(n,"b",(function(){return o})),t.d(n,"c",(function(){return a})),t.d(n,"a",(function(){return r}));var r={pay:function(){return Promise.all([t.e("common/vendor"),t.e("components/pay/pay")]).then(t.bind(null,"1e12"))}},o=function(){var e=this,n=e.$createElement,t=(e._self._c,e.orderInfo&&e.orderInfo.scene&&e.orderInfo.vatMoney>0?e.$t("pay_order.vatMoney"):null),r=e.orderInfo&&e.orderInfo.scene&&e.orderInfo.vatMoney>0?(100*e.orderInfo.vatValue).toFixed(0):null,o=e.orderInfo&&e.orderInfo.scene&&e.orderInfo.taxIncluded>0?e.$t("pay_order.taxIncluded"):null,a=e.orderInfo&&e.orderInfo.scene&&e.orderInfo.taxIncluded>0?e.$t("pay_order.totaltax"):null,c=e.orderInfo&&e.orderInfo.scene&&e.orderInfo.serviceMoney>0?e.$t("pay_order.serviceMoney"):null,u=e.orderInfo&&e.orderInfo.scene&&e.orderInfo.serviceMoney>0?(100*e.orderInfo.serviceValue).toFixed(0):null,i=e.orderInfo&&e.orderInfo.scene&&e.orderInfo.discountMoney>0?e.$t("pay_order.total_discount"):null,d=e.orderInfo&&e.orderInfo.scene?e.$t("pay_order.subtotal"):null,s=e.orderInfo&&e.orderInfo.scene?e.orderInfo.sellMoney&&e.orderInfo.money&&Number(e.orderInfo.sellMoney)>Number(e.orderInfo.money):null;e._isMounted||(e.e0=function(n){e.wcshow=!1}),e.$mp.data=Object.assign({},{$root:{m0:t,g0:r,m1:o,m2:a,m3:c,g1:u,m4:i,m5:d,m6:s}})},a=[]}},[["46b2","common/runtime","common/vendor"]]]);