(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/shop/select/index"],{4871:function(t,e,s){"use strict";s.d(e,"b",(function(){return a})),s.d(e,"c",(function(){return n})),s.d(e,"a",(function(){}));var a=function(){var t=this,e=t.$createElement,s=(t._self._c,t.$t("shop-select.search")),a="recharge"==t.query.page||"cashier"==t.query.page||"fastOrder"==t.query.page||t.dtshow?null:t.$t("shop-select.view_map"),n="recharge"!=t.query.page&&"cashier"!=t.query.page&&"fastOrder"!=t.query.page&&t.dtshow&&t.dtshow?t.$t("shop-select.collapse"):null,i="recharge"!=t.query.page&&"cashier"!=t.query.page&&"fastOrder"!=t.query.page&&t.dtshow&&!t.dtshow?t.$t("shop-select.expand"):null,r="recharge"!=t.query.page&&"cashier"!=t.query.page&&"fastOrder"!=t.query.page&&t.dtshow?t.$t("shop-select.map"):null,o=t.$t("shop-select.place_order"),c=t.$t("shop-select.distance"),l=t.__map(t.dataList[t.aIdx].list,(function(e,s){var a=t.__get_orig(e),n=e.storeSetting&&e.storeSetting&&1==e.storeSetting.takeoutSwitch?t.$t("shop-select.delivery_available"):null,i=e.storeSetting&&e.storeSetting&&1==e.storeSetting.pickupSwitch?t.$t("shop-select.pick_up_available"):null,r=e.storeSetting&&e.storeSetting?e.label&&e.label.length:null,o=t.yysj(e),c=1==e.realtimeState?t.$t("shop-select.open"):null,l=1!=e.realtimeState&&2==e.realtimeState?t.$t("shop-select.busy"):null,d=1!=e.realtimeState&&2!=e.realtimeState?t.$t("shop-select.resting"):null,u=e.storeSetting&&(e.storeSetting.takeSubscribe||e.storeSetting.outAppoint)?t.$t("shop-select.accept_reservations"):null;return{$orig:a,m5:n,m6:i,g0:r,m7:o,m8:c,m9:l,m10:d,m11:u}})),d=0==t.dataList[t.aIdx].list.length&&t.dataList[t.aIdx].isget,u=t.$t("shop-select.place_order"),p=t.$t("shop-select.distance"),h=t.$t("shop-select.frequent"),g=t.__map(t.dataList[t.aIdx].list,(function(e,s){var a=t.__get_orig(e),n=e.storeSetting&&e.storeSetting&&1==e.storeSetting.takeoutSwitch?t.$t("shop-select.delivery_available"):null,i=e.storeSetting&&e.storeSetting&&1==e.storeSetting.pickupSwitch?t.$t("shop-select.pick_up_available"):null,r=e.storeSetting&&e.storeSetting?e.label&&e.label.length:null,o=t.yysj(e),c=1==e.realtimeState?t.$t("shop-select.open"):null,l=1!=e.realtimeState&&2==e.realtimeState?t.$t("shop-select.busy"):null,d=1!=e.realtimeState&&2!=e.realtimeState?t.$t("shop-select.resting"):null,u=e.storeSetting&&(e.storeSetting.takeSubscribe||e.storeSetting.outAppoint)?t.$t("shop-select.accept_reservations"):null;return{$orig:a,m14:n,m15:i,g2:r,m16:o,m17:c,m18:l,m19:d,m20:u}})),f=0==t.dataList[t.aIdx].list.length&&t.dataList[t.aIdx].isget,m=t.$t("shop-select.enter_store_name"),b=t.$t("shop-select.cancel"),y=0==t.ssobj.list.length&&t.ssobj.isget;t._isMounted||(t.e0=function(e){t.dtshow=!t.dtshow},t.e1=function(e){t.dtshow=!t.dtshow}),t.$mp.data=Object.assign({},{$root:{a0:{},m0:s,m1:a,m2:n,m3:i,m4:r,m12:o,m13:c,l0:l,g1:d,m21:u,m22:p,m23:h,l1:g,g3:f,m24:m,m25:b,g4:y}})},n=[]},"4d59":function(t,e,s){"use strict";(function(t){var a=s("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=a(s("7eb4")),i=a(s("7ca3")),r=a(s("ee10")),o=s("8f59"),c=a(s("77a5")),l=s("cc12");function d(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,a)}return s}function u(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?d(Object(s),!0).forEach((function(e){(0,i.default)(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):d(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}var p={name:"select-index",components:{navTab:function(){s.e("components/common/functionCmp/nav-tab").then(function(){return resolve(s("1b29"))}.bind(null,s)).catch(s.oe)},jzz:function(){s.e("components/common/jzz").then(function(){return resolve(s("4f31"))}.bind(null,s)).catch(s.oe)},mgMap:function(){Promise.all([s.e("common/vendor"),s.e("components/form/my-map")]).then(function(){return resolve(s("c179"))}.bind(null,s)).catch(s.oe)}},data:function(){return{aIdx:0,select:{},tabs:[{name:this.$t("shop-select.select_store")},{name:this.$t("shop-select.favorite_store")}],latitude:13.7854976,longitude:100.5879296,covers:[],dwcsInfo:{},dtshow:!1,dataList:[{list:[],isget:!1,mygd:!1,api:"dplb",params:{page:1,size:10,lat:"",lng:"",cityId:"",storeId:""}},{list:[],isget:!1,mygd:!1,api:"dplb",params:{page:1,size:10,lat:"",lng:"",collect:1}}],xzdpidx:-1,ssobj:{list:[],isget:!1,params:{keyword:""}},query:{},issearch:!1,showSearch:!1,zfbH:"h100"}},onLoad:function(e){var s=this;return(0,r.default)(n.default.mark((function a(){return n.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:s.util.setNT(s.$t("shop-select.select_store")),s.query=e,!e||"recharge"!=e.page&&"cashier"!=e.page&&"fastOrder"!=e.page||(s.ssobj.params.recharge=1,s.dataList[0].params.recharge=1),e.searchIds&&(s.ssobj.params.searchIds=e.searchIds,s.dataList[0].params.searchIds=e.searchIds),s.swiperTab({detail:{current:+e.idx||0}}),t.$on("changeCity",(function(t){s.dataList[0]={list:[],isget:!1,mygd:!1,api:"dplb",params:{page:1,size:10,lat:s.dataList[0].params.lat,lng:s.dataList[0].params.lng,cityId:s.dwcsInfo.cityId}},s.xzdpidx=0,s.getList()})),console.log(e),s.sbset&&0==s.sbset.showMapState&&(s.dtshow=!1);case 8:case"end":return a.stop()}}),a)})))()},onUnload:function(){t.$off("changeCity")},computed:u(u(u({},(0,o.mapState)("dndc",["addInfo","latLng"])),(0,o.mapState)({sbset:function(t){return t.config.storeBasicSetting},oset:function(t){return t.config.orderSetting}})),{},{address:function(){return console.log("info",this.addInfo),console.log("12-1",this.latLng),this.addInfo&&1==this.sbset.pageState?this.addInfo.maddress:this.addInfo&&2==this.sbset.pageState?this.addInfo.city.name:this.addInfo?this.addInfo.maddress:this.$t("shop-select.locating")}}),methods:u(u({},(0,o.mapActions)(["getConfig","getSjxx"])),{},{chooseLocation:function(){this.$refs.mgmap.choose(),console.log(121)},chooseArea:function(){this.go({url:"select?info="+encodeURIComponent(JSON.stringify(this.dwcsInfo))})},setCLP:function(t){this.select.address=t.address,this.select.details=t.name,this.select.lat=t.latitude,this.select.lng=t.longitude,this.getAddInfo({address:t.address}),this.dataList[0]={list:[],isget:!1,mygd:!1,api:"dplb",params:{page:1,size:10,lat:t.latitude,lng:t.longitude}},this.getList()},getDwcs:function(t){var e=this;return(0,r.default)(n.default.mark((function s(){return n.default.wrap((function(s){while(1)switch(s.prev=s.next){case 0:e.latitude=e.dataList[0].params.lat=e.dataList[1].params.lat=t.latitude,e.longitude=e.dataList[0].params.lng=e.dataList[1].params.lng=t.longitude,e.dataList[0].params.storeId=e.query.storeId||"";case 3:case"end":return s.stop()}}),s)})))()},stopTouchMove:function(){return!1},changeTab:function(t){},swiperTab:function(t){var e=this;return(0,r.default)(n.default.mark((function s(){var a;return n.default.wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(e.aIdx=t.detail.current,e.dataList[t.detail.current].isget){s.next=11;break}if(0!=e.aIdx||e.dwcsInfo.hasOwnProperty("cityId")){s.next=10;break}return s.next=5,(0,l.getDw)({t:0});case 5:return a=s.sent,s.next=8,e.getAddInfo(a);case 8:return s.next=10,e.getDwcs(a);case 10:e.getList();case 11:case"end":return s.stop()}}),s)})))()},lower:c.default.throttle((function(t){!this.dataList[this.aIdx].mygd&&this.dataList[this.aIdx].isget&&(this.dataList[this.aIdx].isget=!1,this.getList())}),300),getList:function(){var t=this;return(0,r.default)(n.default.mark((function e(){var s,a,i;return n.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.dataList[t.aIdx].params.cityId=t.addInfo.city&&t.addInfo.city.code,s=t.dataList[t.aIdx],e.next=4,t.util.request({url:t.api[t.dataList[t.aIdx].api],data:t.dataList[t.aIdx].params});case 4:a=e.sent,i=a.data.list,s.list=s.list.concat(i),s.isget=!0,s.mygd=s.params.size>i.length,s.params.page++,t.$set(t.dataList,t.aIdx,s),0==t.aIdx&&t.setCovers();case 12:case"end":return e.stop()}}),e)})))()},setCovers:function(){var t=this;this.dataList[0].list[0]&&c.default.stfn((function(){t.latitude=+t.dataList[0].list[0].lat,t.longitude=+t.dataList[0].list[0].lng}),400),this.covers=this.dataList[0].list.map((function(t){return{id:+t.id,latitude:t.lat,longitude:t.lng,iconPath:"/static/geocode.png",width:"25",height:"25",callout:{content:t.name+">",color:"#333",fontSize:14,borderRadius:3,bgColor:"#fff",padding:7,display:"ALWAYS",textAlign:"center"}}})),console.log("888",this.covers)},selectStore:function(e,s){var a=this;return(0,r.default)(n.default.mark((function i(){var r,o;return n.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a.xzdpidx=s,a.latitude=e.lat,a.longitude=e.lng,r="",3==e.realtimeState?r="[".concat(e.name,"] ").concat(a.$t("shop-select.resting")).concat(a.$t("shop-select.confirm_switch_to_store"),"？"):e.distance&&a.oset.shopDistance&&e.distance.split("km")[0]>=a.oset.shopDistance&&(r="".concat(a.$t("shop-select.far_from_store")," ").concat(a.$t("shop-select.confirm_switch_to")," [").concat(e.name,"]  ").concat(a.$t("shop-select.store_query"),"？")),n.prev=5,n.t0=r,!n.t0){n.next=10;break}return n.next=10,a.util.modal(r);case 10:o=a.util.getPage(),o&&"payOrder"!=a.query.page&&"recharge"!=a.query.page&&"index"!=a.query.page&&"cashier"!=a.query.page&&"fastOrder"!=a.query.page?(o.$vm.load(e.id),setTimeout((function(){a.go({t:4})}),200)):"recharge"==a.query.page?(t.setStorageSync("rStoreInfo",e),setTimeout((function(){a.go({t:4})}),500)):"cashier"==a.query.page?(a.getSjxx({storeId:e.id,lat:+a.dataList[0].list[0].lat||"",lng:a.dataList[0].params.lng||""}),setTimeout((function(){a.go({t:3,url:"/pages/shop/in/dmf?storeId=".concat(e.id)})}),500)):"fastOrder"==a.query.page?(a.getSjxx({storeId:e.id,lat:+a.dataList[0].list[0].lat||"",lng:a.dataList[0].params.lng||""}),setTimeout((function(){a.go({t:3,url:"/pages/shop/in/goods?diningType=6&storeId=".concat(e.id)})}),500)):(t.setStorageSync("storeId",e.id),setTimeout((function(){a.go({t:3,url:"/pages/index/goods"})}),500)),n.next=17;break;case 14:n.prev=14,n.t1=n["catch"](5),console.log(n.t1);case 17:case"end":return n.stop()}}),i,null,[[5,14]])})))()},qhdp:function(t){this.getConfig({key:"storeInfo",data:{id:t.id,name:t.name,distance:t.distance}})},markertap:function(t){var e=this.dataList[0].list.find((function(e,s){return e.id==t.detail.markerId})),s=this.dataList[0].list.findIndex((function(e,s){return e.id==t.detail.markerId}));this.selectStore(e,s)},xzcs:function(){this.dwcsInfo.cityId&&this.go({url:"select?info="+encodeURIComponent(JSON.stringify(this.dwcsInfo))})},yysj:function(t){var e="",s=t;return s.businessData&&s.businessData.times&&(e="".concat(s.businessData.times[0].start,"-").concat(s.businessData.times[0].ciri?this.$t("shop-select.next_day"):"").concat(s.businessData.times[0].end),s.businessData.times[1]&&(e+=" "+"".concat(s.businessData.times[1].start,"-").concat(s.businessData.times[1].ciri?this.$t("shop-select.next_day"):"").concat(s.businessData.times[1].end)),s.businessData.times[2]&&(e+=" "+"".concat(s.businessData.times[2].start,"-").concat(s.businessData.times[2].ciri?this.$t("shop-select.next_day"):"").concat(s.businessData.times[2].end))),e},djss:function(){this.showSearch=!0},qxss:function(){this.showSearch=this.issearch=!1,this.ssobj={list:[],isget:!1,params:{keyword:""}}},cleanKey:function(){this.ssobj.params.keyword="",this.issearch=!1,this.ssobj.list=[],this.ssobj.isget=!1},confirm:function(t){if(!this.ssobj.params.keyword)return this.util.message("请输入搜索内容",3);this.ssobj.params.lat=this.dataList[0].params.lat,this.ssobj.params.lng=this.dataList[0].params.lng,this.issearch=!0,this.ssobj.list=[],this.ssobj.isget=!1,this.getssList()},getssList:function(){var t=this;return(0,r.default)(n.default.mark((function e(){var s,a;return n.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.util.request({url:t.api.dplb,data:t.ssobj.params});case 2:s=e.sent,a=s.data.list,t.ssobj.list=t.ssobj.list.concat(a),t.ssobj.isget=!0;case 6:case"end":return e.stop()}}),e)})))()},xzssdp:function(t){var e=this;return(0,r.default)(n.default.mark((function s(){var a;return n.default.wrap((function(s){while(1)switch(s.prev=s.next){case 0:e.qxss(),a=e.dataList[0].list.findIndex((function(t,e){return t.id==t.id})),e.selectStore(t,a);case 3:case"end":return s.stop()}}),s)})))()},bddh:function(t){this.util.makeTel(t.mobile)},ckwz:function(t){this.util.ckWz({lat:t.lat,lng:t.lng,name:t.name,address:t.address})}})};e.default=p}).call(this,s("df3c")["default"])},"60ee":function(t,e,s){"use strict";s.r(e);var a=s("4871"),n=s("6e51");for(var i in n)["default"].indexOf(i)<0&&function(t){s.d(e,t,(function(){return n[t]}))}(i);s("b401");var r=s("828b"),o=Object(r["a"])(n["default"],a["b"],a["c"],!1,null,"23239ed1",null,!1,a["a"],void 0);e["default"]=o.exports},"6e51":function(t,e,s){"use strict";s.r(e);var a=s("4d59"),n=s.n(a);for(var i in a)["default"].indexOf(i)<0&&function(t){s.d(e,t,(function(){return a[t]}))}(i);e["default"]=n.a},b401:function(t,e,s){"use strict";var a=s("d0d5"),n=s.n(a);n.a},d0d5:function(t,e,s){},f207:function(t,e,s){"use strict";(function(t,e){var a=s("47a9");s("b483");a(s("3240"));var n=a(s("60ee"));t.__webpack_require_UNI_MP_PLUGIN__=s,e(n.default)}).call(this,s("3223")["default"],s("df3c")["createPage"])}},[["f207","common/runtime","common/vendor"]]]);