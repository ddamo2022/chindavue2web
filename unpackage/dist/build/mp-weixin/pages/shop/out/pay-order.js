(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/shop/out/pay-order"],{"11f7":function(e,t,n){"use strict";var r=n("2bce"),o=n.n(r);o.a},"2bce":function(e,t,n){},"36b9":function(e,t,n){"use strict";n.r(t);var r=n("e1e5"),o=n("53fb");for(var a in o)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(a);n("11f7");var i=n("828b"),c=Object(i["a"])(o["default"],r["b"],r["c"],!1,null,"3cc988a8",null,!1,r["a"],void 0);t["default"]=c.exports},"53fb":function(e,t,n){"use strict";n.r(t);var r=n("b3b4"),o=n.n(r);for(var a in r)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(a);t["default"]=o.a},b3b4:function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(n("7eb4")),a=r(n("7ca3")),i=r(n("ee10")),c=n("8f59"),s=r(n("77a5"));function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){(0,a.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var l=getApp().globalData,f={components:{SelfFetchAddres:function(){n.e("pages/shop/out/components/self-fetch-addres").then(function(){return resolve(n("099f"))}.bind(null,n)).catch(n.oe)},TakeOutAddres:function(){n.e("pages/shop/out/components/take-out-addres").then(function(){return resolve(n("401b"))}.bind(null,n)).catch(n.oe)},CheckShop:function(){Promise.all([n.e("common/vendor"),n.e("pages/shop/out/components/check-shop")]).then(function(){return resolve(n("1fef"))}.bind(null,n)).catch(n.oe)},CheckTime:function(){Promise.all([n.e("common/vendor"),n.e("pages/shop/out/components/check-time")]).then(function(){return resolve(n("f2f1"))}.bind(null,n)).catch(n.oe)},Pay:function(){Promise.all([n.e("common/vendor"),n.e("components/pay/pay")]).then(function(){return resolve(n("1e12"))}.bind(null,n)).catch(n.oe)},CheckGoods:function(){n.e("components/pay-order/check-goods").then(function(){return resolve(n("375e"))}.bind(null,n)).catch(n.oe)},Discounts:function(){n.e("components/pay-order/discounts").then(function(){return resolve(n("a113"))}.bind(null,n)).catch(n.oe)},CheckNotes:function(){n.e("components/pay-order/check-notes").then(function(){return resolve(n("1cc6"))}.bind(null,n)).catch(n.oe)},ConsumptionGift:function(){n.e("components/goods/consumption-gift").then(function(){return resolve(n("2ccd"))}.bind(null,n)).catch(n.oe)},CheckSave:function(){n.e("pages/shop/out/components/check-save").then(function(){return resolve(n("ec30"))}.bind(null,n)).catch(n.oe)},Tcyhq:function(){Promise.all([n.e("common/vendor"),n.e("components/template/tcyhq")]).then(function(){return resolve(n("783a"))}.bind(null,n)).catch(n.oe)},CheckPoint:function(){n.e("components/pay-order/check-point").then(function(){return resolve(n("ef72"))}.bind(null,n)).catch(n.oe)},businessStatus:function(){n.e("pages/index/goods/business").then(function(){return resolve(n("cb3a"))}.bind(null,n)).catch(n.oe)}},data:function(){return{showLoading:!1,orderInfo:{},deliveryMode:2,params:{remarks:"",serverTime:"",mobile:"",addressId:"",couponId:0},loading:!1,yjrV:{},radioType:1,current:"",wcshow:!1,wcInfo:"",cd:{},zfForm:{}}},onLoad:function(t){var n=this;return(0,i.default)(o.default.mark((function r(){var a;return o.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:n.util.setNT(n.$t("pay-order.submit_order")),n.params.storeId=n.sjxx.id,n.params.mobile=n.user.mobile||"",n.sjxx&&n.sjxx.storeSetting&&n.sjxx.storeSetting.takeEatType&&(n.sjxx.storeSetting.takeEatType.includes(1)&&!n.sjxx.storeSetting.takeEatType.includes(2)?(n.radioType=2,n.current=1):n.current=0),t&&t.diningType&&(a=t.diningType,n.getCheckOut(a)),e.$on("payorder",(function(e){e.hasOwnProperty("hbInfo")&&1==e.type&&(n.params.couponId=e.hbInfo?e.hbInfo.id:0,n.getCheckOut(1==n.deliveryMode?0:n.radioType||n.sjxx.storeSetting.defaultType)),console.log("payorderEl",e)})),n.getWc();case 7:case"end":return r.stop()}}),r)})))()},onShow:function(){l.xzdzInfo&&(this.params.addressId=l.xzdzInfo.id,this.getCheckOut(1==this.deliveryMode?0:this.radioType||this.sjxx.storeSetting.defaultType))},onUnload:function(){e.$off("payorder")},computed:d(d(d(d({},(0,c.mapState)(["sjxx"])),(0,c.mapState)("dndc",["latLng"])),(0,c.mapState)({orderSetting:function(e){return e.config.orderSetting},copywriting:function(e){return e.layout.copywriting},style:function(e){return e.layout.style||{}}})),{},{ModeArr:function(){var e=[];if(this.sjxx.storeSetting){var t=this.sjxx.storeSetting;1==t.pickupSwitch&&1==t.takeoutSwitch?(e=[{name:this.copywriting.dnName||this.$t("pay-order.pick_up"),value:"2",cname:"leftInactive",acname:"leftActive",icon:"icon-zhongbao-mendian"},{name:this.copywriting.wmName||this.$t("pay-order.takeout"),value:"1",cname:"rightInactive",acname:"rightActive",icon:"icon-waimaifuwu"}],2==this.orderSetting.orderPriority&&(e=[{name:this.copywriting.wmName||this.$t("pay-order.takeout"),value:"1",cname:"leftInactive",acname:"leftActive",icon:"icon-waimaifuwu"},{name:this.copywriting.dnName||this.$t("pay-order.pick_up"),value:"2",cname:"rightInactive",acname:"rightActive",icon:"icon-zhongbao-mendian"}]),this.buyType=+e[0].value):0==t.pickupSwitch&&1==t.takeoutSwitch?this.buyType=1:1==t.pickupSwitch&&0==t.takeoutSwitch&&(this.buyType=2)}return e}}),methods:d(d({},(0,c.mapActions)(["getMycar"])),{},{getCheckOut:function(e){var t=this;return(0,i.default)(o.default.mark((function n(){var r,a;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.util.request({url:t.api.checkout,method:"POST",data:{diningType:e,storeId:t.sjxx.id,notes:t.params.remarks,serverTime:t.params.serverTime,mobile:t.params.mobile,addressId:t.params.addressId,couponId:t.params.couponId,lat:t.latLng.lat?t.latLng.lat:"",lng:t.latLng.lng?t.latLng.lng:""}});case 2:r=n.sent,a=r.data,t.cd=a,t.deliveryMode=a.scene,t.addressId=a.addressId,t.orderInfo=s.default.deepCopy(a);case 8:case"end":return n.stop()}}),n)})))()},changeDeliveryMode:function(t){e.setStorageSync("xdtype",t),t.value!=this.deliveryMode&&(this.deliveryMode=t.value,this.yjrV={},this.getCheckOut(1==t?0:this.sjxx.storeSetting.defaultType||1))},setMobile:function(e){console.log(e),this.params.mobile=e,this.getCheckOut(1==this.deliveryMode?0:this.radioType||this.sjxx.storeSetting.defaultType)},yjSelect:function(e){e&&e.value?this.params.serverTime=e.value:this.params.serverTime="",this.yjrV=e,this.getCheckOut(1==this.deliveryMode?0:this.radioType||this.sjxx.storeSetting.defaultType)},setNote:function(e){this.params.remarks=e,this.getCheckOut(1==this.deliveryMode?0:this.radioType||this.sjxx.storeSetting.defaultType)},radioChange:function(e){this.radioType=e,this.getCheckOut(e)},savePay:function(){var e=this;return(0,i.default)(o.default.mark((function t(){return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.cd||3!=e.cd.diningType){t.next=2;break}return t.abrupt("return",e.util.message(e.$t("pay-order.please_select_dining_option"),3));case 2:if(console.log(e.cd),"1"!==e.cd.diningType&&1!==e.cd.diningType&&"2"!==e.cd.diningType&&2!==e.cd.diningType){t.next=6;break}if(e.cd.mobile){t.next=6;break}return t.abrupt("return",e.util.message(e.$t("pay-order.please_enter_contact_number"),3));case 6:if(e.jjmbxx){t.next=16;break}return t.prev=7,t.next=10,e.requestSM(["pay","receive","".concat(1==e.deliveryMode?"delivery":"takeMeal")]);case 10:t.next=16;break;case 12:return t.prev=12,t.t0=t["catch"](7),e.jjmbxx=!0,t.abrupt("return");case 16:e.orderSetting&&1==e.orderSetting.onShopCheck?e.$refs["CheckShop"].open():e.pay();case 17:case"end":return t.stop()}}),t,null,[[7,12]])})))()},pay:function(){var e=this;return(0,i.default)(o.default.mark((function t(){var n,r;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(4!=e.cd.realtimeState||e.params.serverTime){t.next=2;break}return t.abrupt("return",e.util.message(e.$t("pay-order.please_select_appointment_time"),3));case 2:if(1!=e.deliveryMode){t.next=7;break}if(e.addressId){t.next=5;break}return t.abrupt("return",e.util.message(e.$t("pay-order.please_select_address"),3));case 5:t.next=7;break;case 7:if(e.loading=!0,!e.zfForm||!e.zfForm.orderSn){t.next=12;break}e.$refs["Pay"].open(JSON.stringify({orderSn:e.zfForm.orderSn,orderType:1,go:{t:6,url:"/pages/index/order-index"}})),t.next=17;break;case 12:return t.next=14,e.util.request({url:e.api["wmxd"],method:"POST",ct:1,mask:e.$t("pay-order.placing_order")});case 14:n=t.sent,r=n.data,r?(e.zfForm=r,e.$refs["Pay"].open(JSON.stringify({orderSn:r.orderSn,orderType:1,go:{t:6,url:"/pages/index/order-index"}}))):e.loading=!1;case 17:case"end":return t.stop()}}),t)})))()},selectTime:function(){this.$refs["CheckTime"].open(this.deliveryMode)},cPay:function(){this.getMycar({storeId:this.sjxx.id})},getWc:function(){var e=this;return(0,i.default)(o.default.mark((function t(){var n,r;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.util.request({url:e.api.wc,data:{pos:4,storeId:e.sjxx.id}});case 2:n=t.sent,r=n.data,r&&(e.wcInfo=r,setTimeout((function(){e.wcshow=!0}),400));case 5:case"end":return t.stop()}}),t)})))()}})};t.default=f}).call(this,n("df3c")["default"])},b3e2:function(e,t,n){"use strict";(function(e,t){var r=n("47a9");n("b483");r(n("3240"));var o=r(n("36b9"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(o.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},e1e5:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return r}));var r={pay:function(){return Promise.all([n.e("common/vendor"),n.e("components/pay/pay")]).then(n.bind(null,"1e12"))}},o=function(){var e=this,t=e.$createElement,n=(e._self._c,e.orderInfo&&e.orderInfo.scene?e.ModeArr.length:null),r=e.orderInfo&&e.orderInfo.scene&&e.orderInfo.vatMoney>0?e.$t("pay_order.vatMoney"):null,o=e.orderInfo&&e.orderInfo.scene&&e.orderInfo.vatMoney>0?(100*e.orderInfo.vatValue).toFixed(0):null,a=e.orderInfo&&e.orderInfo.scene&&e.orderInfo.taxIncluded>0?e.$t("pay_order.taxIncluded"):null,i=e.orderInfo&&e.orderInfo.scene&&e.orderInfo.taxIncluded>0?e.$t("pay_order.totaltax"):null,c=e.orderInfo&&e.orderInfo.scene&&e.orderInfo.serviceMoney>0?e.$t("pay_order.serviceMoney"):null,s=e.orderInfo&&e.orderInfo.scene&&e.orderInfo.serviceMoney>0?(100*e.orderInfo.serviceValue).toFixed(0):null,u=e.orderInfo&&e.orderInfo.scene&&e.orderInfo.discountMoney?e.$t("pay-order.total_discount"):null,d=e.orderInfo&&e.orderInfo.scene?e.$t("pay-order.subtotal"):null,l=e.orderInfo&&e.orderInfo.scene?e.orderInfo.sellMoney&&e.orderInfo.money&&Number(e.orderInfo.sellMoney)>Number(e.orderInfo.money):null;e._isMounted||(e.e0=function(t){e.wcshow=!1}),e.$mp.data=Object.assign({},{$root:{g0:n,m0:r,g1:o,m1:a,m2:i,m3:c,g2:s,m4:u,m5:d,m6:l}})},a=[]}},[["b3e2","common/runtime","common/vendor"]]]);