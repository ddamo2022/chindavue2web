(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/other/login"],{7230:function(e,t,n){"use strict";var r=n("f12e"),a=n.n(r);a.a},9108:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){}));var r=function(){var e=this,t=e.$createElement,n=(e._self._c,e.$t("login.welcome_message")),r=e.$t("login.enter_email_or_phone"),a=e.$t("login.enter_password"),o=e.$t("login.login"),i=e.$t("login.forgot_password"),u=e.$t("login.no_account"),c=e.$t("login.register");e.$mp.data=Object.assign({},{$root:{m0:n,m1:r,m2:a,m3:o,m4:i,m5:u,m6:c}})},a=[]},"9d28":function(e,t,n){"use strict";(function(e,t){var r=n("47a9");n("b483");r(n("3240"));var a=r(n("df5b"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(a.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},b3fe:function(e,t,n){"use strict";(function(e){var r=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n("7eb4")),o=r(n("7ca3")),i=r(n("ee10")),u=n("e19d"),c=n("8f59");function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){(0,o.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var f={data:function(){return{username:"",password:"",userProfile:null}},components:{uniNavBar:function(){n.e("components/third/uni-nav-bar").then(function(){return resolve(n("c474"))}.bind(null,n)).catch(n.oe)}},onLoad:function(e){var t=this;return(0,i.default)(a.default.mark((function e(){var n,r;return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.isLogin||(n=getApp().globalData.siteInfo.liffId,r=t,(0,u.loadLineSDK)(n).then(function(){var e=(0,i.default)(a.default.mark((function e(t){return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.isLoggedIn()){e.next=4;break}return e.abrupt("return",t.getProfile());case 4:if(!t.isInClient()){e.next=6;break}return e.abrupt("return",t.login());case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then(function(){var e=(0,i.default)(a.default.mark((function e(t){return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t||!t.userId){e.next=4;break}return console.log(t),e.next=4,r.linelogin(t.userId,t.displayName);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.error(e)})));case 1:case"end":return e.stop()}}),e)})))()},mounted:function(){this.initializeFacebookSDK()},methods:l(l({},(0,c.mapMutations)(["setMobile","setToken","setUser"])),{},{linelogin:function(t,n){var r=this;return(0,i.default)(a.default.mark((function o(){var i,u;return a.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,r.util.request({url:r.api.lineLogin,method:"post",data:{id:t,name:n}});case 2:i=a.sent,i.data&&(r.setToken(i.data.token),r.setUser(i.data.userInfo),r.util.message(r.$t("sq-btn.login_successful"),1,1e3),u=e.getStorageSync("redirectPath")||"/",e.removeStorageSync("redirectPath"),e.reLaunch({url:u}));case 4:case"end":return a.stop()}}),o)})))()},initializeFacebookSDK:function(){this.$loadFacebookSDK().then((function(e){console.log("Facebook SDK loaded and initialized.")})).catch((function(e){console.error("Error loading Facebook SDK:",e)}))},login:function(){var t=this;return(0,i.default)(a.default.mark((function n(){return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.username){n.next=2;break}return n.abrupt("return",t.util.message(t.$t("login.enter_email_or_phone_placeholder"),3));case 2:if(t.password){n.next=4;break}return n.abrupt("return",t.util.message(t.$t("login.enter_password_placeholder"),3));case 4:return n.next=6,t.util.request({url:t.api.emaillogin,method:"post",data:{username:t.username,password:t.password}}).then(function(){var n=(0,i.default)(a.default.mark((function n(r){var o;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!r.data){n.next=10;break}console.log("rest",r.data.token),t.$store.commit("setUser",r.data.userInfo),t.$store.commit("setToken",r.data.token),t.util.message(t.$t("sq-btn.login_successful"),1,1e3),o=e.getStorageSync("redirectPath")||"/",e.removeStorageSync("redirectPath"),e.reLaunch({url:o}),n.next=11;break;case 10:return n.abrupt("return",t.util.message(r.msg,3));case 11:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()).catch((function(e){}));case 6:n.sent;case 7:case"end":return n.stop()}}),n)})))()},openforgot:function(){e.navigateTo({url:"/pages/other/forgetting"})},openregister:function(){e.navigateTo({url:"/pages/other/register"})},openlogin:function(t){var n=this;return(0,i.default)(a.default.mark((function r(){var o,u,c,s;return a.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:o=e.getStorageSync("redirectPath")||"/",console.log(o),console.log(getApp().globalData.siteInfo.siteroot),u="".concat(getApp().globalData.siteInfo.siteroot,"/h5/#").concat(o),console.log(u),1==t&&(window.location.href="".concat(getApp().globalData.siteInfo.siteroot,"/line/").concat(getApp().globalData.siteInfo.uniacid,"?refererUrl=").concat(btoa(u)),c=getCurrentPages().pop(),"/".concat(c.route).concat(c.options?"?"+Object.keys(c.options).map((function(e){return"".concat(e,"=").concat(c.options[e])})).join("&"):"")),2==t&&(s=n,FB.login(function(){var e=(0,i.default)(a.default.mark((function e(t){return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.authResponse){e.next=5;break}console.log("Welcome! Fetching your information...."),FB.api("/me",{fields:"id,name,email"},function(){var e=(0,i.default)(a.default.mark((function e(t){var n,r;return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(console.log(t),console.log("Good to see you, "+t.name+"."),n="",t.name&&(n=t.name),r="",t.email&&(r=t.email),!t.id){e.next=11;break}return e.next=9,s.facebooklogin(t.id,n,r);case 9:e.next=12;break;case 11:return e.abrupt("return",s.util.message(s.$t("modal.authorization_failed"),3));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=7;break;case 5:return console.log("User cancelled login or did not fully authorize."),e.abrupt("return",s.util.message(s.$t("modal.authorization_failed"),3));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{scope:"public_profile,email"}));case 7:case"end":return r.stop()}}),r)})))()},facebooklogin:function(t,n,r){var o=this;return(0,i.default)(a.default.mark((function i(){var u,c;return a.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,o.util.request({url:o.api.facebookLogin,method:"post",data:{id:t,name:n,email:r}});case 2:u=a.sent,u.data&&(o.$store.commit("setUser",u.data.userInfo),o.$store.commit("setToken",u.data.token),o.util.message(o.$t("sq-btn.login_successful"),1,1e3),c=e.getStorageSync("redirectPath")||"/",e.removeStorageSync("redirectPath"),e.reLaunch({url:c}));case 4:case"end":return a.stop()}}),i)})))()}})};t.default=f}).call(this,n("df3c")["default"])},df5b:function(e,t,n){"use strict";n.r(t);var r=n("9108"),a=n("e917");for(var o in a)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(o);n("7230");var i=n("828b"),u=Object(i["a"])(a["default"],r["b"],r["c"],!1,null,"0080c007",null,!1,r["a"],void 0);t["default"]=u.exports},e917:function(e,t,n){"use strict";n.r(t);var r=n("b3fe"),a=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=a.a},f12e:function(e,t,n){}},[["9d28","common/runtime","common/vendor"]]]);